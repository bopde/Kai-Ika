<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Daily Operations Report</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;500&display=swap" rel="stylesheet">

<!-- React & ReactDOM -->
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        kaiBurgundy: '#6B1F1F',
        kaiGreen: '#3E5C48',
        kaiYellow: '#F2E6D8',
        kaiBlue: '#1F3A5F'
      },
      fontFamily: {
        serif: ['Playfair Display', 'serif'],
        sans: ['Inter', 'sans-serif']
      }
    }
  }
}
</script>
</head>

<body class="bg-kaiYellow font-sans">
<div id="root"></div>

<script type="text/javascript">
var e = React.createElement;

// Constants
var STAFF = ["Ben","Connor","Dave","Opu","Matt","Jay"];
var TASKS = ["Filleting","Distributions","Scotts","Cans"];
var PRODUCTS = ["Blue Nose (Lg)","Blue Nose (Sml)","Coke","Coke Zero","Crispy Batter","Donation","Gurnard","Hapuku (Lg)","Hapuku (Sml)","John Dory","Kahawai","Tee Shirt","King Fillet","King Steaked","Knife - Gill & Gut","Knife - Set","Knife - Filleting","Knife - Skinning","Knife - Steaking","L&P","Mackeral","Mahi","Marlin (Lg)","Marlin (Sml)","Panko batter","Shake n Bake batter","Knife sharpening","Sistema 3.8L","Snapper","SNA Scale & Fillet","SNA Scale Gut & Gill","SNA Scale only","Sprite","Tarakihi","Tempura Batter","Trevally","Tuna (Lg)","Tuna (Med)","Tuna (Sml)"];
var DISTRIBUTION_LOCATIONS = ["Local School","Community Center","Food Bank","Marae","Church","Youth Center","Senior Center"];
var CANS_LOCATIONS = ["Depot A","Depot B","Main Depot","Recycling Center"];

function App() {
  var _React$useState = React.useState(new Date().toISOString().slice(0,10)),
      date = _React$useState[0],
      setDate = _React$useState[1];
  var _React$useState2 = React.useState(""),
      completedBy = _React$useState2[0],
      setCompletedBy = _React$useState2[1];

  var _React$useState3 = React.useState([]),
      staffRows = _React$useState3[0],
      setStaffRows = _React$useState3[1];
  var _React$useState4 = React.useState([]),
      salesRows = _React$useState4[0],
      setSalesRows = _React$useState4[1];
  var _React$useState5 = React.useState([]),
      distributionRows = _React$useState5[0],
      setDistributionRows = _React$useState5[1];
  var _React$useState6 = React.useState([]),
      cansRows = _React$useState6[0],
      setCansRows = _React$useState6[1];
  var _React$useState7 = React.useState(""),
      totalSales = _React$useState7[0],
      setTotalSales = _React$useState7[1];
  var _React$useState8 = React.useState(localStorage.getItem("webAppUrl")||""),
      webAppUrl = _React$useState8[0],
      setWebAppUrl = _React$useState8[1];
  var _React$useState9 = React.useState(!!localStorage.getItem("webAppUrl")),
      configured = _React$useState9[0],
      setConfigured = _React$useState9[1];
  var _React$useState10 = React.useState(false),
      success = _React$useState10[0],
      setSuccess = _React$useState10[1];

  // Load saved form
  React.useEffect(function(){
    var saved = localStorage.getItem("opsFormData");
    if(saved){
      var data = JSON.parse(saved);
      setDate(data.date||new Date().toISOString().slice(0,10));
      setCompletedBy(data.completedBy||"");
      setTotalSales(data.totalSales||"");
      setStaffRows(data.staffRows||[]);
      setSalesRows(data.salesRows||[]);
      setDistributionRows(data.distributionRows||[]);
      setCansRows(data.cansRows||[]);
    }
  }, []);

  // Autosave
  React.useEffect(function(){
    localStorage.setItem("opsFormData", JSON.stringify({
      date,date,
      completedBy,
      totalSales,
      staffRows,
      salesRows,
      distributionRows,
      cansRows
    }));
  }, [date, completedBy, totalSales, staffRows, salesRows, distributionRows, cansRows]);

  function addStaff(){setStaffRows(staffRows.concat({staffName:"",task:"Filleting",startTime:"",endTime:""}));}
  function addSales(){setSalesRows(salesRows.concat({productName:"",quantity:""}));}
  function addDistribution(){setDistributionRows(distributionRows.concat({binsDistributed:"",distributionTo:""}));}
  function addCans(){setCansRows(cansRows.concat({cansKg:"",cansLocation:""}));}
  function removeRow(setter, idx){setter(function(arr){return arr.filter(function(_,i){return i!==idx;});});}

  function calculateHours(start,end){
    if(!start||!end) return "";
    var sh=start.split(":").map(Number), eh=end.split(":").map(Number);
    var diff=new Date(0,0,0,eh[0],eh[1])-new Date(0,0,0,sh[0],sh[1]);
    if(diff<0) diff+=24*60*60*1000;
    return Math.round(diff/36e5*100)/100;
  }

  function submit(e){
    e.preventDefault();
    if(!date||!completedBy){alert("Fill in Date and Form Completed By"); return;}
    if(!webAppUrl){alert("Configure Web App URL first"); return;}

    var fd=new FormData(), timestamp=new Date().toISOString();

    staffRows.forEach(function(r){
      fd.append("Row Type","STAFF");
      fd.append("Date",date); fd.append("Form Completed By",completedBy); fd.append("Submission Timestamp",timestamp);
      fd.append("Staff Name",r.staffName||""); fd.append("Task",r.task||""); fd.append("Start Time",r.startTime||""); fd.append("End Time",r.endTime||"");
      fd.append("Hours Worked",calculateHours(r.startTime,r.endTime));
      fd.append("Product Name",""); fd.append("Quantity Sold",""); fd.append("Total Sales","");
      fd.append("Bins Distributed",""); fd.append("Distribution To",""); fd.append("Cans KG",""); fd.append("Cans Location","");
    });

    salesRows.forEach(function(r){
      fd.append("Row Type","SALES");
      fd.append("Date",date); fd.append("Form Completed By",completedBy); fd.append("Submission Timestamp",timestamp);
      fd.append("Product Name",r.productName||""); fd.append("Quantity Sold",r.quantity||"");
      fd.append("Total Sales",""); fd.append("Staff Name",""); fd.append("Task",""); fd.append("Start Time",""); fd.append("End Time","");
      fd.append("Hours Worked",""); fd.append("Bins Distributed",""); fd.append("Distribution To",""); fd.append("Cans KG",""); fd.append("Cans Location","");
    });

    if(totalSales){
      fd.append("Row Type","TOTAL_SALES");
      fd.append("Date",date); fd.append("Form Completed By",completedBy); fd.append("Submission Timestamp",timestamp);
      fd.append("Total Sales",totalSales);
    }

    distributionRows.forEach(function(r){
      fd.append("Row Type","DISTRIBUTION");
      fd.append("Date",date); fd.append("Form Completed By",completedBy); fd.append("Submission Timestamp",timestamp);
      fd.append("Bins Distributed",r.binsDistributed||""); fd.append("Distribution To",r.distributionTo||"");
    });

    cansRows.forEach(function(r){
      fd.append("Row Type","CANS");
      fd.append("Date",date); fd.append("Form Completed By",completedBy); fd.append("Submission Timestamp",timestamp);
      fd.append("Cans KG",r.cansKg||""); fd.append("Cans Location",r.cansLocation||"");
    });

    fetch(webAppUrl,{method:"POST",body:fd}).then(function(res){return res.json();}).then(function(json){
      if(!json.success) throw new Error(json.error);
      setSuccess(true); setTimeout(function(){setSuccess(false);},10000);
      setStaffRows([]); setSalesRows([]); setDistributionRows([]); setCansRows([]); setTotalSales(""); setDate(new Date().toISOString().slice(0,10)); setCompletedBy("");
    }).catch(function(err){alert(err.message);});
  }

  if(!configured){
    return e("div",{className:"min-h-screen flex items-center justify-center p-6"},
      e("div",{className:"bg-white p-8 rounded-xl shadow-lg w-full max-w-lg"},
        e("h1",{className:"text-3xl font-serif mb-4 text-center text-kaiBurgundy"},"Setup"),
        e("input",{className:"w-full border rounded px-3 py-2 mb-4 font-sans",placeholder:"Apps Script Web App URL",value:webAppUrl,onChange:function(ev){setWebAppUrl(ev.target.value)}}),
        e("button",{className:"w-full bg-kaiBurgundy hover:bg-red-700 text-white py-2 rounded font-semibold",onClick:function(){localStorage.setItem("webAppUrl",webAppUrl);setConfigured(true);}},"Save & Continue")
      )
    );
  }

  return e("div",{className:"max-w-6xl mx-auto p-4 md:p-6"},
    e("header",{className:"w-full bg-kaiBurgundy text-white flex flex-col items-center py-6 shadow-lg mb-6"},
      e("h1",{className:"text-4xl md:text-5xl font-serif font-bold text-center"},"Daily Operations Report")
    ),
    success && e("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-kaiGreen text-white px-6 py-3 rounded-lg shadow-lg cursor-pointer z-50",onClick:function(){setSuccess(false)}}, "âœ“ Report saved successfully"),
    e("form",{onSubmit:submit,className:"space-y-4"},
      e("div",{className:"bg-white p-4 rounded-lg shadow-md"},
        e("h2",{className:"text-2xl font-serif text-kaiBurgundy mb-3"},"Daily Info"),
        e("div",{className:"grid md:grid-cols-2 gap-3"},
          e("div",null,
            e("label",{className:"block text-sm font-medium text-gray-700 mb-1"},"Date *"),
            e("input",{type:"date",required:true,className:"w-full border rounded px-3 py-2 font-sans",value:date,onChange:function(ev){setDate(ev.target.value)}})
          ),
          e("div",null,
            e("label",{className:"block text-sm font-medium text-gray-700 mb-1"},"Form Completed By *"),
            e("input",{type:"text",required:true,placeholder:"Your name",className:"w-full border rounded px-3 py-2 font-sans",value:completedBy,onChange:function(ev){setCompletedBy(ev.target.value)}})
          )
        )
      ),
      e("div",{className:"flex flex-wrap gap-3 mb-4"},
        e("button",{type:"button",className:"bg-kaiBurgundy hover:bg-red-700 text-white px-5 py-2 rounded-lg font-semibold shadow",onClick:addStaff},"+ Staff"),
        e("button",{type:"button",className:"bg-kaiBurgundy hover:bg-red-700 text-white px-5 py-2 rounded-lg font-semibold shadow",onClick:addSales},"+ Sales"),
        e("button",{type:"button",className:"bg-kaiBurgundy hover:bg-red-700 text-white px-5 py-2 rounded-lg font-semibold shadow",onClick:addDistribution},"+ Distribution"),
        e("button",{type:"button",className:"bg-kaiBurgundy hover:bg-red-700 text-white px-5 py-2 rounded-lg font-semibold shadow",onClick:addCans},"+ Cans")
      ),
      // Total sales field
      salesRows.length > 0 && e("div",{className:"bg-white p-4 rounded-lg shadow-md mb-4"},
        e("label",{className:"block text-sm font-medium text-gray-700 mb-1"},"Total Sales ($)"),
        e("input",{type:"number",step:"0.01",inputMode:"decimal",placeholder:"0.00",className:"w-full border rounded px-3 py-2 font-sans",value:totalSales,onChange:function(ev){setTotalSales(ev.target.value)}})
      )
    )
  );
}

ReactDOM.render(e(App), document.getElementById("root"));
</script>
</body>
</html>
